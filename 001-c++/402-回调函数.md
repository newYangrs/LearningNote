# 什么是回调（Callback）函数

​     回调函数（Callback Function）是怎样一种函数呢？

**函数是用来被调用的，我们调用函数的方法有两种：**

1. 直接调用：在函数A的函数体里通过书写函数B的函数名来调用之，使内存中对应函数B的代码得以执行。这里，A称为“主叫函数”（Caller），B称为“被叫函数”（Callee）。

2. 间接调用：在函数A的函数体里并不出现函数B的函数名，而是**使用指向函数B的函数指针p**来使内存中属于函数B的代码片断得以执行——听起来很酷，是吧。

---



​        比起直接调用来，间接调用的确麻烦，那为什么还要使用间接调用呢？原因很简单——直接调用把函数名都写进函数体了，经过编译器那么一编译，板上钉钉，A注定调用的是B了，这样的程序只能按照程序员事先设计好的流程执行下去，太呆板了。此时，间接调用的巨大灵活性就显现出来了。想一想，如果p是函数A的一个参数（参数是变量，是变量就可以变吗！），那么程序的最终用户完全可以通过操作来改变p的指向——这样，A在通过p调用函数的时候就有机会调用到不同的函数，这样程序的实用性和扩展性就强多了。

​     如果你能明白上面一段话，OK，那么你已经明白回调函数的75%了——因为被间接调用的函数就是回调函数本身，而间接调用是使用回调函数的“第二步”。

​       “第一步”又是什么呢？让我们仔细想想，A通过p来调用B（或者调用其它函数），p是一个指针——空指针是不能用的！所以，“第一步”就是声明函数指针变量p并且为它赋值——即将p绑定到一个将被间接调用的函数上。

- **这样，使用回调函数的完整流程就成了这样：**

  1. **声明函数指针p** 

  2. **向函数指针p赋值，使之指向函数B**
  3.  **把p作为参数传给函数A** 
  4. **函数A通过指针p调用函数B** 
  5.  **函数B的函数体得以执行。**

 

​     现在一个令人迷惑的问题摆在眼前了——Callback这个词里有一个back，上面这个过程哪里体现出“回”了呢？实际上是这样的：

​		函数指针p的来路我们不必去追究——它可能是一个全局变量（大部分情况下是这样），也可能是一个临时变量——对p赋值却是一件着实重要的事情，除了在声明它的时候对它初始化，我们只能在某个函数中去执行对p进行赋值的操作了，我们姑且管这个函数叫K。现在闭上眼睛跟我想，函数K和函数B处在同一个程序模块（比如一个类或者一个DLL）Module_1中，而函数A处在另一个程序模块Modules_2中，把p想象成一条短信。Module_1发短信p给Module_2，短信p的内容是“函数B的内存地址是0XFF1314521EE”，Module_2收到短信后使用这个地址，结果相当于给Module_2“回了个电话”。所以，一个“回”字，是站在包含了函数K和B的模块Module_1的角度上去看而得出的结果。

​		现在想想，台湾的IT同仁保留了Callback一词的英语词条直译，就叫“回呼函数”，真是高明。将Callback特化成计算机专业术语、叫做“回调”真不知道是谁的主意。

